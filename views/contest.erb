<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title><%= @contest.upcase %> | RiPPro solved</title>
  <link rel="stylesheet" href="/assets/css/atcoder.css">

  <% @path = '../' %>
  <%= erb :import %>
  <style>
    td{
      border: solid 1px #212121;
      width: 1000px;
    }
  </style>
  <!-- for graph -->
  <script src="/superagent.js"></script>
  <script>

    var request = window.superagent;
    request
    .get('http://localhost:4567/api/solved/<%= @contest %>')
    .end(function(err, res){
      var result = JSON.parse(res.text).solved
      var users   = JSON.parse(res.text).user
      for(var i = 0 ; i < users.length ; i ++){
        var user = users[i]
        document.getElementsByTagName('th')[i+2].innerHTML = user.substr(0,4)
        for(var j in result[user]){
          var problem = result[user][j]
          if(document.getElementsByClassName(problem)[i] != undefined){
            document.getElementsByClassName(problem)[i].style.backgroundColor = "#8bc34a"            
          }
        }
      }
      console.log(result)
    });

  </script>
</head>
<body>
<%= erb :header %>
<div class="wrapper">  
  <div class='center'>
    <table class="striped centered contest">
      <thead>
        <tr>
          <th rowspan="2" class="light-green lighten-5">rank</th>
          <th rowspan="2" class="light-green lighten-5">name</th>
          <% @users.times do |user| %>
            <th id=<%= user %> class="light-green lighten-5">xxxx</th>
          <% end%> 
        </tr>
      </thead>
      <tbody>
        <% past = "" %>
        <% @contests.sort_by{|a| a[:contest] }.each do |contest| %>
          <% if past != contest[:contest] %>
            <tr>
              <td colspan="<%= @users + 3%>"  class="center grey darken-4">
                <%= contest[:contest] %>          
              </td>
            </tr>
          <% end %>
          <% past = contest[:contest] %>
          <tr>
            <td class="bordered"><%= contest[:name][0] %></td>
            <td class="bordered"><a href="http://<%= contest[:contest] %>.contest.atcoder.jp/tasks/<%= contest[:id] %>"><%= contest[:name].split('.')[1] %></a></td>
            <% @users.times do |user| %>
              <td class="bordered <%= contest[:id] %>"></td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
</body>
</html>
